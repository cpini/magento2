steps:
- name: 'gcr.io/cloud-builders/docker'
  entrypoint: 'bash'
  args: [
    '-c',
    "docker build -t eu.gcr.io/$PROJECT_ID/magento2-apache24:latest -f k8s-config/apache-docker/Dockerfile  --build-arg WEB_SSL_KEY=$$SSL_KEY --build-arg WEB_SSL_CRT=$$SSL_CRT --build-arg WEB_SSL_PEM=$$SSL_PEM ."
    ]
  secretEnv: ['SSL_KEY']
  secretEnv: ['SSL_CRT']
  secretEnv: ['SSL_PEM']
- name: 'gcr.io/cloud-builders/docker'
  args: ['push', "eu.gcr.io/$PROJECT_ID/magento2-apache24:latest"]
images: ["eu.gcr.io/$PROJECT_ID/magento2-apache24"]

secrets:
- kmsKeyName: projects/$PROJECT_ID/locations/global/keyRings/magento-web-secrets/cryptoKeys/magento-webserver
  secretEnv:
    SSL_KEY: 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
- kmsKeyName: projects/$PROJECT_ID/locations/global/keyRings/magento-web-secrets/cryptoKeys/magento-webserver
  secretEnv:
    SSL_CRT: CiQAw4sRuZmMNs5xxnIl+27yK5DDsbM/BJwu7hhERg+sreloYFMS+wkA0Ywmfz/Qdh5dUcHBsyB1NOqVrJgYzKKWZl74x9K6Cr/E9TVCKUMrHycE8BtFyf2tW2WwZ7Xjl7zeNOJJsyGOpWauu60HE8Wbkt/sHr/74zPkxgvhBn3+Xh2GIrkGQkeS7UxjT6gzLQDQKY8PK5gMVDnjqbTGtPvNCdXIXNIhd4xvU8+KnswDaX98HGZdqf22OdyWuT9nqa3mMp/34WOVEZh0coJa4YsOb3Y+EI3JtuY9ZiUBIsFM//19ic/jQ5tldM0CQ5fKjp8/9+/10IjZTavGS7mW74svE4RmvNQj3qU29YeKe6qofOYTcsXGXp/kD6BBK0b8xxWZk1Yy4SQAsp+Csrrmppy3rx4a6AgiFAWc6KVCipUV7yq2vviGO3/R5ShP81czhKPCTjrldMmC0Loy1v/8QV8TrTJ418fXLJK1uKV6ytsjiTYiFyzar5am7SoGiTL4G5WapQUOaibgw5A+D6epQbl1rtdzsY26e8FJiV6w4Xnmk7zHrPFIMfZtn5Y8g8EEpG6n76LJgbfCe2k5GswcwAnsJ4A96xksziCVpf+6PMEaHOU5iQQK9gxY0XFlPVUfruH/gyd9UOJZQ9o1ATYnp1OiSd92pISq0EaJ3UUZ4Iubi1V79+d0aduF2IEwBYlDJkxbjX09rC+4NfHbsWwtCKqCD1XFIhnTjc4+A6W2tmkRULR+85Le+hP0Xswrm5XqPMuKZ6Jd+jWmpsANtD86ytu1nTGkeC3+7o/fyUJuHe1ozu8XqZ2UBwb+3YA0ZCQTOEoNpiBNWytQGjGjyyR5yjLc0gbWxyVEGZoZ5jCThOFvo481Yw1dAQwsAlfpODH6/96Frl4qk69mPbF3kHUKpWSAWzlZvYdIxA8GgurKG9BciEu8RyiMdoUgmrPaQ0Pe8+9zeLfR6Vbm6CCG3XicRvO+uNEV9+/SWq2+lUyjoJY0bBonuJjr1CYdUgL0Ix4buDA0F2e7N1DjKQaYqr9dedpeglB51h+Y1LjSmvtUYCmajhWpgKU5TnYKy5pMW8qHdAaitmNi3Y9jlWicnUtyMUHsRfyZrxCqf7sElbMqcDSdXWKKGZ0oKrbF4JtC7BIefUjQgtkEthWt1GnlkbLiAlTYGjdrebISZSHdI6IH511Nl6wyl08oVbyq7xTDkhLU0AdSt8as1V/6oh1kucYClqnK9adiurYOnTL2sNthb8u6Du7VIrXcn/ZGCLlnxLvjnZMgCmc2yd+CNSZnI96kbTFBke7LrpFKYMmXhAaDLVn0wBkrfSfbBDNVTvLD8ScffuAZSYQTx5xbIRNKU/l5EP5KLs9Oi9V7HocrnF8E6QifF2TaHB/bOO0KVbPyykSmkAsj5Ird0QLti+Da+lHILjv9vv49fTzZHyGC+mAbM5ToPtNOujy6p4c/BA4CbTI8SSyIBF2U5A/8UkgPpqxhhA/PriR2Od3z66F3MaCvqKfc0m8XNYasWaL6qJ0Upir5z9CEMH/6H5cnhO0eqS1So+4LSbvGpGyHlmiBufQ1V9HGclSMONOfKRTYc5jeXN2vWABvL+g+t044ObyAOmpR7rD6IImpa80Lk+eBRabww1QCi5sggi7q8/Jretc9gpLV0oDM+hSUD+VYlE9TZGSotPVmXxqCK15Ff+oYdyXg9UyWoma0fLiHKGnxM3kP5yK4ykYFJpZa3FD8nsIcrYENL+LUI70=
- kmsKeyName: projects/$PROJECT_ID/locations/global/keyRings/magento-web-secrets/cryptoKeys/magento-webserver-pem
  secretEnv:
    SSL_PEM: CiQAmlC+DQzi5Bw9FPr250pF1qXAENPK8T5Orc+6RZmm3jZ4vpwSmwgAiZ2etaNK4HxXJ3AcM8Li9jvkvKuV6Lmq/HtpTVM8gY0h0RGfvtBzQ4mFyH3mWq7d6Dw4tLerGXv7fXSqMKIg71qgkmjibWn6we+vDpduPBffrHlmkN5kt5lEZHw8VOlX5SIcSYYhFO6gDQq4tvIhDcxdp4RHRh+s+HuD5L5K+31gNFSVcm64WXGNHZpmpa66oScbnhCzz+1d7Sbxlv0ABjWxygBOGH/7PVW8Ed4mZ94xmf+AkkYuVAIl/Tl3OATmzVeQoAt51BOBnyqBBZ8i6nGNyivh3TnxlAm+I5FhAMTplSaUvQ6vQNYkMy0OVhPQcrrDGOWECJ4yjcfvolLvzI4+w+8XsBQ7OZLA8D4Vpx0peruvK7CNOzMTxRySY7bpmNUxFWVysn3JjSpzGFZE47kLMVBaaI1dX7BZz+lpcMfbo9kttCMQ+pRVcikm/JiW2UfVYs9ucUZKHDJHs4iRcPG3cxSqTrzHQ5dSCDcHjx/UGKwKtEaTKdV9XA+EBF7Rau2BqfvQDfr8X9CRx7h3aJ+DO2WmmD7BHU+Z8HxX+TwAD4XkegI6S4qoQM3nF/gqWbgw7lVM7CUdyViYSG3oV0yAs+OHa2iQsvkdnGpPKUpTXeiI+18yF356xr9a1tfntdp0uqGo3NyRePsbPbxvaHQGLB6jy65wtHio1gatod5hup9N+GLTxHASyaf0aViN5HPwZCe1aiW37iV/jyxf3UF9CNSiFmtR7+gL/yoHhyrZkpIthhKlxc76BWz18vsN/SVjARv07bOpfrgwx+0voM1Oj1VAGwI8IrSpK5jm3HMjw5UgOuA1Mj63FJN/ELXFAF6q5EtJixPqM/noSdxnFDeYE6hWIzUfCe/Iw+SvRXU1WP+rAIoWbsk8HJbPBLssDDgsaZf6S4JftL4SFsJOoPt4pfKshBO9E8SExZ9smvrC7JD2dqguJ2UIcrXQGrEp1XyUmsuAtwlPIZ6SBhMwYBXTltjyqR753yT3r8muJ/eGhBDOJpA3W5csHCuhmThGQMGqj8bDnIb9yt+TYwsmT8pA3yWUhhmXbT9CoXVct1HKhtj4gBGoHfboXo1u24YjKbIrU9Vb0ndUqBcNxdy/sf5be9YFI5fCeOD79qUrB3HbO6sdC5xTXgMZ5p5ftGENDbodTaBstL8Fma9cq+ggoQkNdFlMNZAxiHTy4r3YiWq/bCF5bg8+5+TXtjRp6TUgYG2WzT2YomT1uIQBP6d5TP9/D4bXBW/tq3e6WP/X9yOX+aRr0nRf5dQK+5dMOsy4lG3j3rT1PnUS5oYaGCKBoYuiTraLfSttFVJpwe4dPSAVqxEep16wIANv4MGO42XY/OEQqqXZlMQVX2OXVZQR/tCxlk9abDeQaHKdrDncrDAnmH1ROF84wRAl
